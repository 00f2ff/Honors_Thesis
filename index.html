<!DOCTYPE html>
<html>
<head>
	<title>Shopping</title>
	<link rel="stylesheet" type="text/css" href="research.css">
</head>
<body>

	<!-- Overlay handles 6x4 key rhombus -->
	<div id="overlay">
		<!-- 1-6 -->
		<div class="hover-row"></div>
		<!-- Q-Y -->
		<div class="hover-row"></div>
		<!-- A-H -->
		<div class="hover-row"></div>
		<!-- Z-N -->
		<div class="hover-row"></div>
	</div>
	<div id="search">
		<div id="title">Shopping</div>
		<div id="search-bar">
			<form>
				<input type="text" />
			</form>
			<div id="search-icon"></div>
		</div>
	</div>
	<div id="content-wrapper">
		<!-- link list -->
		<div id="link_list">
			<ul></ul>
		</div>
		<!-- table -->
		<div id="table">
		<!-- Will be different for Home / Suggestion vs Product -->
			<!-- I found that sites like Amazon and Etsy never show more than 3 products per row, so I'm going to reverse rows and columns; Q, A and Z will access indexes 0, 1 and 2, respectively, and hovering over keys to the right will show products farther down the page -->			
		</div>
	</div>


<!-- such javascript -->
<script src="scripts/jquery-1.11.3.min.js"></script>
<script src="scripts/global.js"></script>
<script src="scripts/table.js"></script>
<script src="scripts/link_list.js"></script>
<script src="scripts/api_key.js"></script>
<script src="scripts/etsy.js"></script>
<script src='https://code.responsivevoice.org/responsivevoice.js'></script> <!-- find out if google is better -->
<script>




	var etsy = new Etsy();
	etsy.getRequest('listings', 'listings/trending', {'limit': 30});
	etsy.getRequest('categories', 'taxonomy/categories', {});
	// etsy.getRequest('listings', 'listings/active', {'limit': 30, 'category': 'candles'});
	// etsy.getRequest('listings', 'listings/active', {'limit': 30, 'keywords': 'birthday%20cards'}); // search will just replace spaces %20 and remove all other non-alphabetical characters
	// etsy.getRequest('sub-categories', 'taxonomy/categories/accessories', {});

	// Keycode arrays. Index of key corresponds with index of cell in hover-row
	var linkListKeyCodes = [49,50,51,52,53,54];
	var tableFirstColumnKeyCodes = [81,87,69,82,84,89];
	var tableSecondColumnKeyCodes = [65,83,68,70,71,72];
	var tableThirdColumnKeyCodes = [90,88,67,86,66,78];

	// Note: I don't think I need to preventDefault on keypresses since I'm not using special keys

	
	// Assigns click handler to cells (effect differs based on cell type)
	// $('body').on('click', '.cell', function(e) {
	$('body').keydown(function(e) {
		// find which hover-row had a cell pressed
		var kc = e.keyCode;
		console.log(kc);		
		if (linkListKeyCodes.indexOf(kc) > -1) {
			activateCategoryCell(kc);
		}
		// implement for table once I get product pages figured out
		else if (kc === 37) { // left arrow
			// Find which row is currently hovered over
			// participants will need instruction on how hovering + arrow keys work
			if ($('.hover-row:first-of-type:hover').length > 0) {
				linkList.left();
			}
		} else if (kc === 39) { // right arrow
			if ($('.hover-row:first-of-type:hover').length > 0) {
				linkList.right();
			}
		}
	});

	/*
	 * Moving logic to external function to make keydown handler less awful
	 */
	function activateCategoryCell(kc) {
		var cell = $('.hover-row:first-child .cell:nth-child('+(1+linkListKeyCodes.indexOf(kc))+')');
		console.log(cell);
		if (cell.data('name') === '/') {
			// call the 'Popular Products' removal function in LinkedList
			linkList.removePopularProducts();
			etsy.getRequest('listings', 'listings/trending', {'limit': 30});
		} else {
			// check if popular products is already shown
			if ($('.hover-row').first().children(':first').data('name') !== '/') {
				linkList.addPopularProducts();
			}
			etsy.getRequest('listings', 'listings/active', {'limit': 30, 'category': $(this).data('name')});
		}
	}


/* 
To Do:

- Write Table and LinkList interaction code based on research.js (this includes hovering and touch activation)
- Check whether pressing certain Fingers keys changes how the software operates while people interact with my application. If it does, read Fingers code and change those key bindings in a separate branch
- Design and develop product page
- Add search capability

*/



</script>
</body>
</html>